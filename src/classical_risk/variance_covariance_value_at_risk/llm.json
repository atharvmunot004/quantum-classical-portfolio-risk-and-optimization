{
  "task": "classical_var_evaluation_optimized",

  "design_principle": {
    "estimation_scope": "asset_level",
    "portfolio_projection": true,
    "rationale": "Historical return distributions are constructed once at the asset level and reused across portfolio weight realizations via linear projection, ensuring scalability, statistical consistency, and bounded memory usage for large-scale portfolio simulations."
  },

  "inputs": {
    "panel_price_path": "data/processed/panel_price.parquet",
    "portfolio_weights_path": "portfolios/portfolios.parquet"
  },

  "var_settings": {
    "method": "historical",

    "confidence_levels": [0.95, 0.99],

    "horizons": {
      "base_horizon": 1,
      "scaled_horizons": [10],
      "scaling_rule": "sqrt_time",
      "assumptions": {
        "iid_returns": true,
        "note": "Square-root-of-time scaling is applied as a benchmark approximation; limitations are discussed relative to EVT and GARCH-based models."
      }
    },

    "estimation_windows": [252],

    "tail_side": "left",
    "return_type": "log",

    "loss_convention": {
      "losses_positive": true,
      "note": "Portfolio losses are defined as negative returns multiplied by -1 for VaR evaluation."
    }
  },

  "computation_strategy": {
    "compute_asset_returns_once": true,
    "reuse_asset_return_matrix": true,
    "disable_per_portfolio_return_recomputation": true,

    "projection_method": "linear",

    "parallelization": {
      "axis": ["estimation_window"],
      "backend": "process",
      "max_workers": "cpu_count_minus_one",
      "cpu_affinity": true,
      "enable_window_parallel": true,
      "enable_portfolio_parallel": true,
      "chunk_size": 10,
      "note": "Window-level parallelization processes multiple estimation windows in parallel. Portfolio-level parallelization processes multiple portfolios within each batch in parallel. Chunk size controls batching for parallel portfolio processing."
    },

    "memory_management": {
      "max_memory_fraction": 0.75,
      "enable_chunked_execution": true,
      "enable_explicit_gc": true,
      "spill_intermediate_to_disk": true,
      "intermediate_store_format": "parquet",
      "flush_frequency_batches": 1
    },

    "batching": {
      "portfolios_batch_size": 500,
      "adaptive_batching": true,
      "note": "Batch size is dynamically reduced if memory pressure exceeds safe thresholds."
    }
  },

  "modules": {
    "compute_daily_returns": true,

    "construct_asset_return_matrix": {
      "enabled": true,
      "output_shape": "[num_days, num_assets]",
      "storage": {
        "format": "parquet",
        "path": "cache/historical_asset_returns.parquet"
      }
    },

    "portfolio_return_projection": {
      "enabled": true,
      "formula": "R_p(t) = W^T R_assets(t)"
    },

    "historical_var": {
      "enabled": true,
      "quantile_method": "empirical",
      "interpolation": "linear"
    },

    "backtesting": {
      "enabled": true,
      "evaluation_mode": "rolling_out_of_sample",

      "tests": [
        "hit_rate",
        "violation_ratio",
        "kupiec_unconditional_coverage",
        "christoffersen_independence",
        "christoffersen_conditional_coverage"
      ],

      "traffic_light": {
        "enabled": true,
        "method": "basel",
        "alpha": 0.99,
        "window_size_days": 250,
        "note": "Traffic-light evaluation is reported only for the 99% VaR level in line with Basel guidance."
      }
    },

    "tail_metrics": [
      "mean_exceedance",
      "max_exceedance",
      "std_exceedance",
      "quantile_loss_score",
      "rmse_var_vs_losses"
    ],

    "portfolio_structure_metrics": {
      "enabled": true,
      "metrics": [
        "num_active_assets",
        "hhi_concentration",
        "effective_number_of_assets",
        "covariance_condition_number"
      ],
      "active_weight_threshold": 1e-06
    },

    "distribution_metrics": {
      "enabled": true,
      "metrics": [
        "skewness",
        "kurtosis",
        "jarque_bera_p_value"
      ]
    },

    "time_sliced_metrics": {
      "enabled": true,
      "slice_by": "year",
      "memory_note": "Computed sequentially per slice to avoid cross-period memory accumulation."
    },

    "runtime_metrics": true
  },

  "performance_metrics": {
    "accuracy": [
      "hit_rate",
      "violation_ratio",
      "kupiec_unconditional_coverage",
      "christoffersen_independence",
      "christoffersen_conditional_coverage",
      "traffic_light_zone"
    ],

    "tail_behavior": [
      "mean_exceedance",
      "max_exceedance",
      "std_exceedance",
      "quantile_loss_score",
      "rmse_var_vs_losses"
    ],

    "portfolio_structure": [
      "num_active_assets",
      "hhi_concentration",
      "effective_number_of_assets",
      "covariance_condition_number"
    ],

    "distribution": [
      "skewness",
      "kurtosis",
      "jarque_bera_p_value"
    ],

    "runtime": [
      "runtime_per_portfolio_ms",
      "p95_runtime_ms",
      "projection_time_ms"
    ]
  },

  "outputs": {
    "metrics_table": {
      "format": "parquet",
      "path": "results/classical_risk/var_metrics.parquet",
      "partition_by": ["confidence_level", "horizon"],
      "compression": "zstd"
    },

    "metrics_schema": {
      "format": "json",
      "path": "results/classical_risk/var_metrics_schema.json",
      "content": "column_names_dtypes_units_and_indexing"
    },

    "summary_report": {
      "format": "markdown",
      "path": "results/classical_risk/var_report.md",
      "include_tables": false,
      "include_figures": true
    }
  },

  "reproducibility": {
    "random_seed": 42,
    "deterministic_projection": true,
    "notes": "Portfolio weights are fixed ex-ante via Dirichlet sampling."
  },

  "paper_usage_notes": {
    "simulation_phase": "Asset-level historical return matrices with linear projection enable scalable evaluation across 100K+ portfolios.",
    "paper_phase": "Comparisons with filtered historical simulation, EVT, and GARCH models are conducted on representative portfolio subsets."
  }
}
